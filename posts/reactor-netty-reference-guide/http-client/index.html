<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.81.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Reactor Netty参考指南 - 6.HTTP客户端&nbsp;&ndash;&nbsp;Immuthex的博客</title><meta name="keywords" content="Reactor Netty,Reactor Netty中文文档,Reactor Netty参考指南" /><meta name="description" content="Reactor Netty参考指南第六章（HTTP客户端）中文翻译" /><link rel="stylesheet" href="/css/core.min.615fa51c37c342f9111f46db696ab299cb089e23d2925a922a047a7a740f5f2e314b9888c9db5136fcdc211089b9dfa6.css" integrity="sha384-YV&#43;lHDfDQvkRH0bbaWqymcsIniPSklqSKgR6enQPXy4xS5iIydtRNvzcIRCJud&#43;m"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Reactor Netty参考指南 - 6.HTTP客户端" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">Immuthex的博客</span></a></span>
        <span class="header right-side"><div class="nav wrap">
    <nav class="nav"><a class="nav item" href="/categories/">分类</a><a class="nav item" href="/tags/">标签</a><a class="nav item" href="https://github.com/immuthex" target="_blank" one-link-mark="yes"><span
                class="iconfont icon-github"></span>&nbsp;Github</a>
    </nav>
</div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Reactor Netty参考指南 - 6.HTTP客户端</h1><p class="article date">2021-03-10</p></section><article class="article markdown-body"><p>Reactor Netty参考指南第六章（HTTP客户端）中文翻译</p>
<h2 id="reactor-netty参考指南目录contents"><a href="../contents">Reactor Netty参考指南目录</a>
</h2>
<hr>
<h1 id="原文地址httpsprojectreactoriodocsnettyreleasereferenceindexhtmlhttp-client"><a href="https://projectreactor.io/docs/netty/release/reference/index.html#http-client"target="_blank" rel="noopener noreferrer">原文地址</a>
</h1>
<p>Reactor Netty提供了易于使用、易于配置的<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClient.html"target="_blank" rel="noopener noreferrer"><code>HttpClient</code></a>
。它隐藏了创建<code>HTTP</code>客户端所需的大部分<code>Netty</code>的功能，并增加了<code>Reactive Streams</code>背压。</p>
<h1 id="61连接">6.1.连接</h1>
<p>要将<code>HTTP</code>客户端连接到给定的<code>HTTP</code>端点，您必须创建并且配置一个<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClient.html"target="_blank" rel="noopener noreferrer"><code>HttpClient</code></a>
实例。示例如下：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/connect/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span> HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>  <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>                       <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">//&lt;3&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>                  <span style="color:#75715e">//&lt;4&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 创建一个<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClient.html"target="_blank" rel="noopener noreferrer">HttpClient</a>
实例用来进行的配置操作。</p>
<p>&lt;2&gt; 指定使用<code>GET</code>方法</p>
<p>&lt;3&gt; 指定路径地址</p>
<p>&lt;4&gt; 获取响应<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClientResponse.html"target="_blank" rel="noopener noreferrer">HttpClientResponse</a>
</p>
</blockquote>
<p>下面是使用<code>WebSocket</code>的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/websocket/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.buffer.Unpooled<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> io.netty.util.CharsetUtil<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.core.publisher.Flux<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span> HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">websocket</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;wss://echo.websocket.org&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">handle</span><span style="color:#f92672">((</span>inbound<span style="color:#f92672">,</span> outbound<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
		          inbound<span style="color:#f92672">.</span><span style="color:#a6e22e">receive</span><span style="color:#f92672">()</span>
		                 <span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>
		                 <span style="color:#f92672">.</span><span style="color:#a6e22e">take</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
		                 <span style="color:#f92672">.</span><span style="color:#a6e22e">subscribe</span><span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">::</span>println<span style="color:#f92672">);</span>

		          <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> msgBytes <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span>CharsetUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">ISO_8859_1</span><span style="color:#f92672">);</span>
		          <span style="color:#66d9ef">return</span> outbound<span style="color:#f92672">.</span><span style="color:#a6e22e">send</span><span style="color:#f92672">(</span>Flux<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span>Unpooled<span style="color:#f92672">.</span><span style="color:#a6e22e">wrappedBuffer</span><span style="color:#f92672">(</span>msgBytes<span style="color:#f92672">),</span> Unpooled<span style="color:#f92672">.</span><span style="color:#a6e22e">wrappedBuffer</span><span style="color:#f92672">(</span>msgBytes<span style="color:#f92672">)))</span>
		                         <span style="color:#f92672">.</span><span style="color:#a6e22e">neverComplete</span><span style="color:#f92672">();</span>
		      <span style="color:#f92672">})</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">blockLast</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<h2 id="611host和port">6.1.1.Host和Port</h2>
<p>想要连接指定的host和port，您可以按照如下方式配置<code>HTTP</code>客户端：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/address/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">host</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;example.com&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>				          <span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">(</span>80<span style="color:#f92672">);</span>           <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 配置<code>HTTP</code>的host</p>
<p>&lt;2&gt; 配置<code>HTTP</code>的port</p>
</blockquote>
<h1 id="62预先初始化">6.2.预先初始化</h1>
<p>默认情况下，<code>HttpClient</code>初始化资源的操作在需要使用的时候才进行。这意味着<code>第一个请求</code>会占用初始化和加载所需的额外时间：</p>
<ul>
<li>
<p>事件循环组</p>
</li>
<li>
<p>主机名解析器</p>
</li>
<li>
<p>native传输库（当使用了native传输的时候）</p>
</li>
<li>
<p>用于安全性的native库（使用了<code>OpenSsl</code>的时候）</p>
</li>
</ul>
<p>当您需要预加载这些资源的时候，您可以按照以下方式来配置<code>HttpClient</code>：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/warmup/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.core.publisher.Mono<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.ByteBufFlux<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span> HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">warmup</span><span style="color:#f92672">()</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">send</span><span style="color:#f92672">(</span>ByteBufFlux<span style="color:#f92672">.</span><span style="color:#a6e22e">fromString</span><span style="color:#f92672">(</span>Mono<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">)))</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span> <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 初始化和加载事件循环组，主机名解析器，native传输库和用于安全性的native库</p>
<p>&lt;2&gt; 在发送到第一个请求的时候会进行主机名解析。在这个例子中，使用了一个连接池，所以发送第一个请求的时候就建立了与URL的连接，后续对同一URL的请求就会重复使用池中的连接。</p>
</blockquote>
<h1 id="63写出数据">6.3.写出数据</h1>
<p>如果要发送数据到一个已有的<code>HTTP</code>端点，您需要通过<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClient.RequestSender.html#send-org.reactivestreams.Publisher-"target="_blank" rel="noopener noreferrer"><code>send(Publisher)</code></a>
方法提供一个<code>Publisher</code>。默认情况下，对于那些用到了request body的<code>HTTP</code>方法会设置<code>Transfer-Encoding: chunked</code>。如果有必须，可以通过设置<code>Content-Length</code>来禁用掉<code>Transfer-Encoding: chunked</code>。下面是发送<code>hello</code>字符串的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/send/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.core.publisher.Mono<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.ByteBufFlux<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span> HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">send</span><span style="color:#f92672">(</span>ByteBufFlux<span style="color:#f92672">.</span><span style="color:#a6e22e">fromString</span><span style="color:#f92672">(</span>Mono<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">)))</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 向给定的<code>HTTP</code>端点发送<code>hello</code>字符串</p>
</blockquote>
<h2 id="631添加headers和其他元数据">6.3.1.添加Headers和其他元数据</h2>
<p>当您给已连接的客户端发送数据的时候，您可能想发送额外的headers,cookies和其他的元数据。您可以按照如下配置来实现：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/send/headers/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.handler.codec.http.HttpHeaderNames<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.core.publisher.Mono<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.ByteBufFlux<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">headers</span><span style="color:#f92672">(</span>h <span style="color:#f92672">-&gt;</span> h<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>HttpHeaderNames<span style="color:#f92672">.</span><span style="color:#a6e22e">CONTENT_LENGTH</span><span style="color:#f92672">,</span> 5<span style="color:#f92672">));</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">send</span><span style="color:#f92672">(</span>ByteBufFlux<span style="color:#f92672">.</span><span style="color:#a6e22e">fromString</span><span style="color:#f92672">(</span>Mono<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">)))</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 设置<code>Content-Length</code>头并且禁用掉<code>Transfer-Encoding: chunked</code>。</p>
</blockquote>
<h3 id="压缩">压缩</h3>
<p>您可以开启<code>HTTP</code>客户端的压缩，这意味着需要添加<code>Accept-Encoding</code>请求头。示例如下：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/compression/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">compress</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<h3 id="支持自动重定向">支持自动重定向</h3>
<p>您可以通过配置<code>HTTP</code>客户端来开启自动重定向。</p>
<p>Reactor Netty提供了两种不同的策略来实现自动重定向：</p>
<ul>
<li>
<p><code>followRedirect(boolean)</code>：指定对与status是<code>301|302|307|308</code>的是否启用HTTP的自动重定向。</p>
</li>
<li>
<p><code>followRedirect(BiPredicate&lt;HttpClientRequest, HttpClientResponse&gt;)</code>：如果提供的predicate匹配上了，则启用自动重定向。</p>
</li>
</ul>
<p>下面是使用<code>followRedirect(true)</code>的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/redirect/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">followRedirect</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<h1 id="64消费数据">6.4.消费数据</h1>
<p>如果要接收从已有<code>HTTP</code>端点发过来的数据，您可以使用<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClient.ResponseReceiver.html"target="_blank" rel="noopener noreferrer"><code>HttpClient.ResponseReceiver</code></a>
中的方法来实现。下面是使用<code>responseContent</code>方法的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/read/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span> HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">aggregate</span><span style="color:#f92672">()</span>       <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>        <span style="color:#75715e">//&lt;3&gt;
</span><span style="color:#75715e"></span>		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 从已有的<code>HTTP</code>端点接收数据</p>
<p>&lt;2&gt; 汇总数据</p>
<p>&lt;3&gt; 将数据转成字符串</p>
</blockquote>
<h3 id="641读取headers和其他的元数据">6.4.1.读取Headers和其他的元数据</h3>
<p>当接受从已有<code>HTTP</code>端点发送过来的数据的时候，您可以检查响应头，状态码和其他元数据。您可以使用<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClientResponse.html"target="_blank" rel="noopener noreferrer"><code>HttpClientResponse</code></a>
来获取额外的元数据。示例如下：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/read/status/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span> HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseSingle</span><span style="color:#f92672">((</span>resp<span style="color:#f92672">,</span> bytes<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
		          System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>resp<span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">());</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>		          <span style="color:#66d9ef">return</span> bytes<span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">();</span>
		      <span style="color:#f92672">})</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 获取状态码。</p>
</blockquote>
<h2 id="642http响应解码器">6.4.2.HTTP响应解码器</h2>
<p>默认情况下，<code>Netty</code>为传入的响应配置了一些限制，例如：</p>
<ul>
<li>
<p>初始行的最大长度。</p>
</li>
<li>
<p>所有头的最大长度。</p>
</li>
<li>
<p>content或每个chunk的最大长度。</p>
</li>
</ul>
<p>更多信息请查看<a href="https://netty.io/4.1/api/io/netty/handler/codec/http/HttpResponseDecoder.html"target="_blank" rel="noopener noreferrer">HttpResponseDecoder</a>
</p>
<p>默认情况下，<code>HTTP</code>客户端配置如下：</p>
<blockquote>
<p>./../../reactor-netty-http/src/main/java/reactor/netty/http/HttpDecoderSpec.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> DEFAULT_MAX_INITIAL_LINE_LENGTH <span style="color:#f92672">=</span> 4096<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> DEFAULT_MAX_HEADER_SIZE         <span style="color:#f92672">=</span> 8192<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> DEFAULT_MAX_CHUNK_SIZE          <span style="color:#f92672">=</span> 8192<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">boolean</span> DEFAULT_VALIDATE_HEADERS    <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> DEFAULT_INITIAL_BUFFER_SIZE     <span style="color:#f92672">=</span> 128<span style="color:#f92672">;</span>
</code></pre></div></blockquote>
<blockquote>
<p>./../../reactor-netty-http/src/main/java/reactor/netty/http/client/HttpResponseDecoderSpec.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">boolean</span> DEFAULT_FAIL_ON_MISSING_RESPONSE         <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">boolean</span> DEFAULT_PARSE_HTTP_AFTER_CONNECT_REQUEST <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * The maximum length of the content of the HTTP/2.0 clear-text upgrade request.
</span><span style="color:#75715e"> * By default the client will allow an upgrade request with up to 65536 as
</span><span style="color:#75715e"> * the maximum length of the aggregated content.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> DEFAULT_H2C_MAX_CONTENT_LENGTH <span style="color:#f92672">=</span> 65536<span style="color:#f92672">;</span>
</code></pre></div></blockquote>
<p>当您需要改变这些配置的时候，您可以通过如下方式配置<code>HTTP</code>客户端：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/responsedecoder/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">httpResponseDecoder</span><span style="color:#f92672">(</span>spec <span style="color:#f92672">-&gt;</span> spec<span style="color:#f92672">.</span><span style="color:#a6e22e">maxHeaderSize</span><span style="color:#f92672">(</span>16384<span style="color:#f92672">));</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">aggregate</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 全部头的最大长度为<code>16384</code>。当超过这个值的时候会引发<a href="https://netty.io/4.1/api/io/netty/handler/codec/TooLongFrameException.html"target="_blank" rel="noopener noreferrer">TooLongFrameException</a>
。</p>
</blockquote>
<h1 id="65生命周期回调">6.5.生命周期回调</h1>
<p>下面的生命周期回调用参数是提供给您用来扩展<code>HttpClient</code>的：</p>
<table>
<thead>
<tr>
<th>Callback</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>doAfterRequest</code></td>
<td>当请求被发送之后调用。</td>
</tr>
<tr>
<td><code>doAfterResolve</code></td>
<td>成功解析远程地址后调用。</td>
</tr>
<tr>
<td><code>doAfterResponseSuccess</code></td>
<td>当响应数据全部被接收之后调用。</td>
</tr>
<tr>
<td><code>doOnChannelInit</code></td>
<td>在初始化channel的时候调用。</td>
</tr>
<tr>
<td><code>doOnConnect</code></td>
<td>在channel将要连接的时候调用。</td>
</tr>
<tr>
<td><code>doOnConnected</code></td>
<td>在channel已经连接上的时候调用。</td>
</tr>
<tr>
<td><code>doOnDisconnected</code></td>
<td>在channel断开连接之后调用。</td>
</tr>
<tr>
<td><code>doOnError</code></td>
<td>当请求没有被发送和响应没有被完全接收到的时候调用。</td>
</tr>
<tr>
<td><code>doOnRedirect</code></td>
<td>当接收到响应头并且将要将请求重定向的时候调用。</td>
</tr>
<tr>
<td><code>doOnRequest</code></td>
<td>当将要发送请求的时候调用。</td>
</tr>
<tr>
<td><code>doOnRequestError</code></td>
<td>当请求没有被发送的时候调用。</td>
</tr>
<tr>
<td><code>doOnResolve</code></td>
<td>在将要解析远程地址的时候调用。</td>
</tr>
<tr>
<td><code>doOnResolveError</code></td>
<td>在解析远程地址失败的时候调用。</td>
</tr>
<tr>
<td><code>doOnResponse</code></td>
<td>在接收到响应头之后被调用。</td>
</tr>
<tr>
<td><code>doOnResponseError</code></td>
<td>在响应没有被完全接收到的时候调用。</td>
</tr>
</tbody>
</table>
<p>下面是使用<code>doOnConnection</code>和<code>doOnChannelInit</code>回调的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/lifecycle/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.handler.logging.LoggingHandler<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> io.netty.handler.timeout.ReadTimeoutHandler<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.TimeUnit<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">doOnConnected</span><span style="color:#f92672">(</span>conn <span style="color:#f92672">-&gt;</span>
				              conn<span style="color:#f92672">.</span><span style="color:#a6e22e">addHandler</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ReadTimeoutHandler<span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">)))</span>   <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>				          <span style="color:#f92672">.</span><span style="color:#a6e22e">doOnChannelInit</span><span style="color:#f92672">((</span>observer<span style="color:#f92672">,</span> channel<span style="color:#f92672">,</span> remoteAddress<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span>
				              channel<span style="color:#f92672">.</span><span style="color:#a6e22e">pipeline</span><span style="color:#f92672">()</span>
				                     <span style="color:#f92672">.</span><span style="color:#a6e22e">addFirst</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> LoggingHandler<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;reactor.netty.examples&#34;</span><span style="color:#f92672">)));</span> <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 在连接之后添加了一个<code>ReadTimeoutHandler</code>到<code>Netty</code> pipeline。</p>
<p>&lt;2&gt; 在初始化channel的时候添加了一个<code>LoggingHandler</code>到<code>Netty</code> pipeline。</p>
</blockquote>
<h1 id="66tcp层面的配置">6.6.TCP层面的配置</h1>
<p>当您需要修改TCP层面的配置的时候，您可以使用以下代码段来扩展默认的<code>TCP</code>客户端配置（添加一个option，绑定地址等等）：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/channeloptions/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.channel.ChannelOption<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.InetSocketAddress<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">bindAddress</span><span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">new</span> InetSocketAddress<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;host&#34;</span><span style="color:#f92672">,</span> 1234<span style="color:#f92672">))</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">option</span><span style="color:#f92672">(</span>ChannelOption<span style="color:#f92672">.</span><span style="color:#a6e22e">CONNECT_TIMEOUT_MILLIS</span><span style="color:#f92672">,</span> 10000<span style="color:#f92672">);</span>

		String response <span style="color:#f92672">=</span>
				client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">aggregate</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>

		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Response &#34;</span> <span style="color:#f92672">+</span> response<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<p>更多关于<code>TCP</code>层面的配置请查看<a href="https://projectreactor.io/docs/netty/release/reference/index.html#tcp-client"target="_blank" rel="noopener noreferrer">TCP Client</a>
。</p>
<h3 id="661wire-logger">6.6.1.Wire Logger</h3>
<p>Reactor Netty提供了线路记录（wire logging）用来检查点对点的流量。默认情况下，线路记录是关闭的。如果想要开启它，您必须将日志<code>reactor.netty.http.client.HttpClient</code>的设置为<code>DEBUG</code>等级并且按如下方式进行配置：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/wiretap/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">wiretap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 开启线路记录</p>
</blockquote>
<p>默认情况下，线路记录在输出内容的时候会使用<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#HEX_DUMP"target="_blank" rel="noopener noreferrer">AdvancedByteBufFormat#HEX_DUMP</a>
。您也可以通过配置<code>HttpClient</code>改为<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#SIMPLE"target="_blank" rel="noopener noreferrer">AdvancedByteBufFormat#SIMPLE</a>
或者<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#TEXTUAL"target="_blank" rel="noopener noreferrer">AdvancedByteBufFormat#TEXTUAL</a>
：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/wiretap/custom/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.handler.logging.LogLevel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.transport.logging.AdvancedByteBufFormat<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">wiretap</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;logger-name&#34;</span><span style="color:#f92672">,</span> LogLevel<span style="color:#f92672">.</span><span style="color:#a6e22e">DEBUG</span><span style="color:#f92672">,</span> AdvancedByteBufFormat<span style="color:#f92672">.</span><span style="color:#a6e22e">TEXTUAL</span><span style="color:#f92672">);</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 开启线路记录并使用<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#TEXTUAL"target="_blank" rel="noopener noreferrer">AdvancedByteBufFormat#TEXTUAL</a>
来输出内容。</p>
</blockquote>
<h1 id="67ssl和tls">6.7.SSL和TLS</h1>
<p>当您需要使用SSL或者TLS的时候，可以使用下面列出来方式进行配置。默认情况下，如果<code>OpenSSL</code>可用的话，则使用<a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslProvider.html#OPENSSL"target="_blank" rel="noopener noreferrer"><code>SslProvider.OPENSSL</code></a>
。否则使用<a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslProvider.html#JDK"target="_blank" rel="noopener noreferrer"><code>SslProvider.JDK</code></a>
。可以通过<a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslContextBuilder.html#sslProvider-io.netty.handler.ssl.SslProvider-"target="_blank" rel="noopener noreferrer"><code>SslContextBuilder</code></a>
或者设置<code>-Dio.netty.handler.ssl.noOpenSsl=true</code>来进行切换：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/security/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.handler.ssl.SslContextBuilder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		SslContextBuilder sslContextBuilder <span style="color:#f92672">=</span> SslContextBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">forClient</span><span style="color:#f92672">();</span>

		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">secure</span><span style="color:#f92672">(</span>spec <span style="color:#f92672">-&gt;</span> spec<span style="color:#f92672">.</span><span style="color:#a6e22e">sslContext</span><span style="color:#f92672">(</span>sslContextBuilder<span style="color:#f92672">));</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<h2 id="671服务器名称标识">6.7.1.服务器名称标识</h2>
<p>默认情况下，<code>HTTP</code>客户端将远程主机名作为<code>SNI</code>服务器名发送。当您需要修改默认设置的时候，您可以通过如下方式配置<code>HTTP</code>客户端：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/sni/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.handler.ssl.SslContext<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> io.netty.handler.ssl.SslContextBuilder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.net.ssl.SNIHostName<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
		SslContext sslContext <span style="color:#f92672">=</span> SslContextBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">forClient</span><span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>

		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">secure</span><span style="color:#f92672">(</span>spec <span style="color:#f92672">-&gt;</span> spec<span style="color:#f92672">.</span><span style="color:#a6e22e">sslContext</span><span style="color:#f92672">(</span>sslContext<span style="color:#f92672">)</span>
				                              <span style="color:#f92672">.</span><span style="color:#a6e22e">serverNames</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> SNIHostName<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;test.com&#34;</span><span style="color:#f92672">)));</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://127.0.0.1:8080/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<h1 id="68重试策略">6.8.重试策略</h1>
<p>默认情况下，如果请求在<code>TCP</code>层被中断了<code>HTTP</code>客户端会重试一次。</p>
<h1 id="69http2">6.9.HTTP/2</h1>
<p>默认情况下，<code>HTTP</code>客户端支持<code>HTTP/1.1</code>。如果您需要<code>HTTP/2</code>，您可以通过配置来实现。除了协议配置外，如果您需要<code>H2</code>而不是<code>H2C</code>（<code>明文</code>）的话，还必须配置SSL。</p>
<blockquote>
<p>由于JDK8不支持 &ldquo;开箱即用 &ldquo;的应用层协议协商（ALPN）（尽管一些厂商将ALPN移植到JDK8），您需要添加额外的本地库依赖来支持它，例如：<a href="https://netty.io/wiki/forked-tomcat-native.html"target="_blank" rel="noopener noreferrer"><code>netty-tcnative-boringssl-static</code></a>
。</p>
</blockquote>
<p>下面列出了一个简单的<code>H2</code>的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/http2/H2Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.handler.codec.http.HttpHeaders<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.core.publisher.Mono<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.HttpProtocol<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.util.function.Tuple2<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">H2Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">protocol</span><span style="color:#f92672">(</span>HttpProtocol<span style="color:#f92672">.</span><span style="color:#a6e22e">H2</span><span style="color:#f92672">)</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>				          <span style="color:#f92672">.</span><span style="color:#a6e22e">secure</span><span style="color:#f92672">();</span>                 <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>
		Tuple2<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> HttpHeaders<span style="color:#f92672">&gt;</span> response <span style="color:#f92672">=</span>
				client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseSingle</span><span style="color:#f92672">((</span>res<span style="color:#f92672">,</span> bytes<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> bytes<span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>
				                                           <span style="color:#f92672">.</span><span style="color:#a6e22e">zipWith</span><span style="color:#f92672">(</span>Mono<span style="color:#f92672">.</span><span style="color:#a6e22e">just</span><span style="color:#f92672">(</span>res<span style="color:#f92672">.</span><span style="color:#a6e22e">responseHeaders</span><span style="color:#f92672">())))</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>

		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Used stream ID: &#34;</span> <span style="color:#f92672">+</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getT2</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;x-http2-stream-id&#34;</span><span style="color:#f92672">));</span>
		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Response: &#34;</span> <span style="color:#f92672">+</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getT1</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 配置客户端仅支持<code>HTTP/2</code></p>
<p>&lt;2&gt; 配置<code>SSL</code></p>
</blockquote>
<h2 id="691选择协议">6.9.1.选择协议</h2>
<blockquote>
<p>./../../reactor-netty-http/src/main/java/reactor/netty/http/HttpProtocol.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">enum</span> HttpProtocol <span style="color:#f92672">{</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * The default supported HTTP protocol by HttpServer and HttpClient
</span><span style="color:#75715e">	 */</span>
	HTTP11<span style="color:#f92672">,</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * HTTP/2.0 support with TLS
</span><span style="color:#75715e">	 * &lt;p&gt;If used along with HTTP/1.1 protocol, HTTP/2.0 will be the preferred protocol.
</span><span style="color:#75715e">	 * While negotiating the application level protocol, HTTP/2.0 or HTTP/1.1 can be chosen.
</span><span style="color:#75715e">	 * &lt;p&gt;If used without HTTP/1.1 protocol, HTTP/2.0 will always be offered as a protocol
</span><span style="color:#75715e">	 * for communication with no fallback to HTTP/1.1.
</span><span style="color:#75715e">	 */</span>
	H2<span style="color:#f92672">,</span>

	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * HTTP/2.0 support with clear-text.
</span><span style="color:#75715e">	 * &lt;p&gt;If used along with HTTP/1.1 protocol, will support H2C &#34;upgrade&#34;:
</span><span style="color:#75715e">	 * Request or consume requests as HTTP/1.1 first, looking for HTTP/2.0 headers
</span><span style="color:#75715e">	 * and {@literal Connection: Upgrade}. A server will typically reply a successful
</span><span style="color:#75715e">	 * 101 status if upgrade is successful or a fallback HTTP/1.1 response. When
</span><span style="color:#75715e">	 * successful the client will start sending HTTP/2.0 traffic.
</span><span style="color:#75715e">	 * &lt;p&gt;If used without HTTP/1.1 protocol, will support H2C &#34;prior-knowledge&#34;: Doesn&#39;t
</span><span style="color:#75715e">	 * require {@literal Connection: Upgrade} handshake between a client and server but
</span><span style="color:#75715e">	 * fallback to HTTP/1.1 will not be supported.
</span><span style="color:#75715e">	 */</span>
	H2C
<span style="color:#f92672">}</span>
</code></pre></div></blockquote>
<h1 id="610度量">6.10.度量</h1>
<p>HTTP客户端支持与<a href="https://micrometer.io/"target="_blank" rel="noopener noreferrer">Micrometer</a>
的内置集成。它暴露了所有前缀为<code>reactor.netty.http.client</code>的度量。</p>
<p>下面的表格提供了HTTP客户端度量的相关信息：</p>
<table>
<thead>
<tr>
<th>度量名称</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>reactor.netty.http.client.data.received</td>
<td>DistributionSummary</td>
<td>收到的数据量，以字节为单位</td>
</tr>
<tr>
<td>reactor.netty.http.client.data.sent</td>
<td>DistributionSummary</td>
<td>发送的数据量，以字节为单位</td>
</tr>
<tr>
<td>reactor.netty.http.client.errors</td>
<td>Counter</td>
<td>发生的错误数量</td>
</tr>
<tr>
<td>reactor.netty.http.client.tls.handshake.time</td>
<td>Timer</td>
<td>TLS握手所花费的时间</td>
</tr>
<tr>
<td>reactor.netty.http.client.connect.time</td>
<td>Timer</td>
<td>连接远程地址所花费的时间</td>
</tr>
<tr>
<td>reactor.netty.http.client.address.resolver</td>
<td>Timer</td>
<td>解析远程地址所花费的时间</td>
</tr>
<tr>
<td>reactor.netty.http.client.data.received.time</td>
<td>Timer</td>
<td>接收传入数据所花费的时间</td>
</tr>
<tr>
<td>reactor.netty.http.client.data.sent.time</td>
<td>Timer</td>
<td>传出数据所花费的时间</td>
</tr>
<tr>
<td>reactor.netty.http.client.response.time</td>
<td>Timer</td>
<td>请求/响应的总时间</td>
</tr>
</tbody>
</table>
<p>下面额外的度量也是可用的：</p>
<p>池化的<code>ConnectionProvider</code>度量</p>
<table>
<thead>
<tr>
<th>度量名称</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>reactor.netty.connection.provider.total.connections</td>
<td>Gauge</td>
<td>所有连接的数，包括活跃的和空闲的</td>
</tr>
<tr>
<td>reactor.netty.connection.provider.active.connections</td>
<td>Gauge</td>
<td>已经被成功获取了并且正在使用的连接数</td>
</tr>
<tr>
<td>reactor.netty.connection.provider.idle.connections</td>
<td>Gauge</td>
<td>空闲的连接数</td>
</tr>
<tr>
<td>reactor.netty.connection.provider.pending.connections</td>
<td>Gauge</td>
<td>正在等待可用连接的请求数</td>
</tr>
</tbody>
</table>
<p><code>ByteBufAllocator</code>度量</p>
<table>
<thead>
<tr>
<th>度量名称</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>reactor.netty.bytebuf.allocator.used.heap.memory</td>
<td>Gauge</td>
<td>堆内存的字节数</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.direct.memory</td>
<td>Gauge</td>
<td>堆外内存的字节数</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.heap.arenas</td>
<td>Gauge</td>
<td>堆内存的个数（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.direct.arenas</td>
<td>Gauge</td>
<td>堆外内存的个数（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.threadlocal.caches</td>
<td>Gauge</td>
<td>threadlocal的缓存数量（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.tiny.cache.size</td>
<td>Gauge</td>
<td>微小缓存的大小（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.small.cache.size</td>
<td>Gauge</td>
<td>小缓存的大小（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.normal.cache.size</td>
<td>Gauge</td>
<td>一般缓存的大小（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
<tr>
<td>reactor.netty.bytebuf.allocator.used.chunk.size</td>
<td>Gauge</td>
<td>一个区域的块大小（当使用<code>PooledByteBufAllocator</code>的时候）</td>
</tr>
</tbody>
</table>
<p>下面是开启集成的度量的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/metrics/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.micrometer.core.instrument.Metrics<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> io.micrometer.core.instrument.config.MeterFilter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Metrics<span style="color:#f92672">.</span><span style="color:#a6e22e">globalRegistry</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>		       <span style="color:#f92672">.</span><span style="color:#a6e22e">config</span><span style="color:#f92672">()</span>
		       <span style="color:#f92672">.</span><span style="color:#a6e22e">meterFilter</span><span style="color:#f92672">(</span>MeterFilter<span style="color:#f92672">.</span><span style="color:#a6e22e">maximumAllowableTags</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;reactor.netty.http.client&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;URI&#34;</span><span style="color:#f92672">,</span> 100<span style="color:#f92672">,</span> MeterFilter<span style="color:#f92672">.</span><span style="color:#a6e22e">deny</span><span style="color:#f92672">()));</span>

		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">metrics</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> s <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
				              <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/stream/&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span> <span style="color:#75715e">//&lt;2&gt;
</span><span style="color:#75715e"></span>				                  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;/stream/{n}&#34;</span><span style="color:#f92672">;</span>
				              <span style="color:#f92672">}</span>
				              <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/bytes/&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
				                  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;/bytes/{n}&#34;</span><span style="color:#f92672">;</span>
				              <span style="color:#f92672">}</span>
				              <span style="color:#66d9ef">return</span> s<span style="color:#f92672">;</span>
				          <span style="color:#f92672">});</span> <span style="color:#75715e">//&lt;3&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://httpbin.org/stream/2&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">blockLast</span><span style="color:#f92672">();</span>

		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://httpbin.org/bytes/1024&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">blockLast</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 设置带有<code>URI</code>标签的仪表的上限</p>
<p>&lt;2&gt; 在可能的情况下，模板化的URI将被用作URI标签的值。</p>
<p>&lt;3&gt; 启用内置集成的Micrometer</p>
</blockquote>
<blockquote>
<p>为了避免启用度量而造成的内存和CPU的开销，如果可以的话，将真实的URI转换为模板化的URI是很重要的。如果不转换为类似于模板的形式，则会导致每一个不同的URI都会创建一个不同的标签，这样度量会占用大量的内存。</p>
</blockquote>
<blockquote>
<p>始终对带有URI标签的仪表设置一个上限。给仪表配置一个上线以防真实的URI不能被模板化。您可以在<a href="https://micrometer.io/docs/concepts#_denyaccept_meters"target="_blank" rel="noopener noreferrer"><code>maximumAllowableTags</code></a>
找更多的信息。</p>
</blockquote>
<p>如果您想让HTTP客户端度量与除了<code>Micrometer</code>之外的系统集成或者想提供自己与<code>Micrometer</code>的集成来添加自己的度量记录器，您可以按如下方式实现：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/metrics/custom/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.channel.ChannelMetricsRecorder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.net.SocketAddress<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.time.Duration<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">metrics</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> CustomHttpClientMetricsRecorder<span style="color:#f92672">::</span><span style="color:#66d9ef">new</span><span style="color:#f92672">);</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://httpbin.org/stream/2&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 开启HTTP客户端度量并且提供<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/http/client/HttpClientMetricsRecorder.html"target="_blank" rel="noopener noreferrer"><code>HttpClientMetricsRecorder</code></a>
的实现。</p>
</blockquote>
<h1 id="611unix域套接字">6.11.Unix域套接字</h1>
<p>当使用本地传输时，<code>HTTP</code>客户端支持Unix域套接字（UDS）。</p>
<p>下面是使用UDS的例子：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/uds/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.channel.unix.DomainSocketAddress<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">remoteAddress</span><span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">new</span> DomainSocketAddress<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/tmp/test.sock&#34;</span><span style="color:#f92672">));</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">response</span><span style="color:#f92672">()</span>
		      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 指定将使用的<code>DomainSocketAddress</code></p>
</blockquote>
<h1 id="612主机名解析">6.12.主机名解析</h1>
<p>默认情况下，<code>HttpClient</code>使用Netty的域名查询机制来异步解析域名。用来替代JVM内置阻塞解析器。</p>
<p>当您需要修改默认设置的时候，您可以像如下通过配置<code>HttpClient</code>来实现：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/resolver/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.time.Duration<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">resolver</span><span style="color:#f92672">(</span>spec <span style="color:#f92672">-&gt;</span> spec<span style="color:#f92672">.</span><span style="color:#a6e22e">queryTimeout</span><span style="color:#f92672">(</span>Duration<span style="color:#f92672">.</span><span style="color:#a6e22e">ofMillis</span><span style="color:#f92672">(</span>500<span style="color:#f92672">)));</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		String response <span style="color:#f92672">=</span>
				client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">aggregate</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>

		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Response &#34;</span> <span style="color:#f92672">+</span> response<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 解析器每次执行DNS查询的超时时间设置为500ms。</p>
</blockquote>
<p>下面的列表展示了可用的配置：</p>
<table>
<thead>
<tr>
<th>配置名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cacheMaxTimeToLive</code></td>
<td>DNS资源记录缓存的最大存活时间（单位：秒）。如果DNS服务器返回的DNS资源记录的存活时间大于这个最大存活时间。该解析器将忽略来自DNS服务器的存活时间，并使用这个最大存活时间。默认为<code>Integer.MAX_VALUE</code></td>
</tr>
<tr>
<td><code>cacheMinTimeToLive</code></td>
<td>DNS资源记录缓存的最小存活时间（单位：秒）。如果DNS服务器返回的 DNS 资源记录的存活时间小于这个最小存活时间，则此解析器将忽略来自DNS服务器的存活时间并使用这个最小存活时间。默认：0。</td>
</tr>
<tr>
<td><code>cacheNegativeTimeToLive</code></td>
<td>DNS查询失败的缓存时间（单位：秒）。默认：0。</td>
</tr>
<tr>
<td><code>disableOptionalRecord</code></td>
<td>禁用自动包含的可选设置，该设置会试图告诉远程DNS服务器解析器每次响应可以读取多少数据。默认情况下，该设置为启用状态。</td>
</tr>
<tr>
<td><code>disableRecursionDesired</code></td>
<td>用于指定该解析器在查询DNS的时候会不会带上期望递归查询（RD）的标志，默认情况下，该设置为启用状态。</td>
</tr>
<tr>
<td><code>maxPayloadSize</code></td>
<td>设置数据报包缓冲区的容量（单位：字节）。 默认：4096</td>
</tr>
<tr>
<td><code>maxQueriesPerResolve</code></td>
<td>设置解析主机名允许发送的最大DNS查询次数。默认：16</td>
</tr>
<tr>
<td><code>ndots</code></td>
<td>设置在进行初始化绝对查询的时候，名称中必须出现的点的数量。默认值：-1（用于判断Unix操作系统的值，否则使用1）。</td>
</tr>
<tr>
<td><code>queryTimeout</code></td>
<td>设置该解析器每次DNS查询的超时时间（单位：毫秒）。默认：5000</td>
</tr>
<tr>
<td><code>resolvedAddressTypes</code></td>
<td>解析地址的协议族列表。</td>
</tr>
<tr>
<td><code>roundRobinSelection</code></td>
<td>启用<a href="https://netty.io/4.1/api/io/netty/resolver/dns/DnsNameResolver.html"target="_blank" rel="noopener noreferrer"><code>DnsNameResolver</code></a>
的<a href="https://netty.io/4.1/api/io/netty/resolver/AddressResolverGroup.html"target="_blank" rel="noopener noreferrer"><code>AddressResolverGroup</code></a>
，用于当命名服务器提供了多个地址的时候支持随机选择目标地址。参见<a href="https://netty.io/4.1/api/io/netty/resolver/dns/RoundRobinDnsAddressResolverGroup.html"target="_blank" rel="noopener noreferrer"><code>RoundRobinDnsAddressResolverGroup</code></a>
。默认：<a href="https://netty.io/4.1/api/io/netty/resolver/dns/DnsAddressResolverGroup.html"target="_blank" rel="noopener noreferrer"><code>DnsAddressResolverGroup</code></a>
。</td>
</tr>
<tr>
<td><code>runOn</code></td>
<td>在给定的<a href="https://projectreactor.io/docs/netty/release/api/reactor/netty/resources/LoopResources.html"target="_blank" rel="noopener noreferrer"><code>LoopResources</code></a>
上执行与DNS服务器的通信。默认情况下，LoopResources只在客户端上被使用。</td>
</tr>
<tr>
<td><code>searchDomains</code></td>
<td>解析器的搜索域列表。默认情况下，有效搜索域列表是使用的系统DNS搜索域。</td>
</tr>
<tr>
<td><code>trace</code></td>
<td>在解析器在解析失败时生成详细的跟踪信息时使用的日志记录器和日志级别。</td>
</tr>
</tbody>
</table>
<p>有时候，您或许想切换为JVM内建的解析器。您可以通过如下配置<code>HttpClient</code>的方式来实现：</p>
<blockquote>
<p>./../../reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/client/resolver/custom/Application.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> io.netty.resolver.DefaultAddressResolverGroup<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> reactor.netty.http.client.HttpClient<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> <span style="color:#f92672">{</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		HttpClient client <span style="color:#f92672">=</span>
				HttpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
				          <span style="color:#f92672">.</span><span style="color:#a6e22e">resolver</span><span style="color:#f92672">(</span>DefaultAddressResolverGroup<span style="color:#f92672">.</span><span style="color:#a6e22e">INSTANCE</span><span style="color:#f92672">);</span> <span style="color:#75715e">//&lt;1&gt;
</span><span style="color:#75715e"></span>
		String response <span style="color:#f92672">=</span>
				client<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">uri</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;https://example.com/&#34;</span><span style="color:#f92672">)</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">responseContent</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">aggregate</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">asString</span><span style="color:#f92672">()</span>
				      <span style="color:#f92672">.</span><span style="color:#a6e22e">block</span><span style="color:#f92672">();</span>

		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Response &#34;</span> <span style="color:#f92672">+</span> response<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>&lt;1&gt; 设置为JVM内建的解析器。</p>
</blockquote>
<p><a href="https://github.com/reactor/reactor-netty/edit/master/docs/asciidoc/http-client.adoc"target="_blank" rel="noopener noreferrer">Suggest Edit</a>
 to &ldquo;<a href="https://projectreactor.io/docs/netty/release/reference/index.html#http-client"target="_blank" rel="noopener noreferrer">HTTP Client</a>
&rdquo;</p>
<hr>
<h2 id="reactor-netty参考指南目录contents-1"><a href="../contents">Reactor Netty参考指南目录</a>
</h2></article><section class="article labels"><a class="category" href=/categories/%E7%BF%BB%E8%AF%91/>翻译</a><a class="tag" href=/tags/reactor-netty/>reactor netty</a></section><section class="article license">版权声明：如需转载，请带上本文链接、注明来源和本声明。否则将追究法律责任。https://www.immuthex.com/posts/reactor-netty-reference-guide/http-client</section><section class="article author"><div class="details"><a class="item" href="https://github.com/immuthex" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;immuthex</a></div>
</section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/posts/reactor-netty-reference-guide/udp-server/"><span class="iconfont icon-article"></span>Reactor Netty参考指南 - 7.UDP服务端</a></p><p><a class="link" href="/posts/reactor-netty-reference-guide/http-server/"><span class="iconfont icon-article"></span>Reactor Netty参考指南 - 5.HTTP服务端</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">©2021 immuthex</p></div>
</section></body>

</html>